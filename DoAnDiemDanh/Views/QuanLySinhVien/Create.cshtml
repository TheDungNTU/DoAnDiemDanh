@model DoAnDiemDanh.Models.SINHVIEN
@using DoAnDiemDanh.Models
@{
        ViewBag.Title = "Create";
        Layout = "~/Views/Layout/_LayoutAdmin.cshtml";
        IEnumerable<LOP> LOP = (IEnumerable<LOP>)ViewBag.Lop;
    <script>
        var loadFile = function (event) {
        var image = document.getElementById('output');
        image.src = URL.createObjectURL(event.target.files[0]);
    };
    </script>
}

<label class="h3 mb-4 text-gray-800">Thêm Sinh Viên Mới</label>

@using (Html.BeginForm("Create", "QuanLySinhVien", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            <div class="h3 mb-2 ml-2 text-gray-800" style="font-size: 20px; font-weight: 600;">Tên Sinh Viên</div>
            <div class="col-md-5">
                @Html.EditorFor(model => model.TenSV, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.TenSV, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="h3 mb-2 ml-2 text-gray-800" style="font-size: 20px; font-weight: 600;">Tên Khoa</div>
            <div class="col-md-5">
                @Html.DropDownListFor(model => model.MaKhoa,ViewBag.Khoa as SelectList,"--Mời bạn chọn Khoa--", htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.MaKhoa, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="h3 mb-2 ml-2 text-gray-800" style="font-size: 20px; font-weight: 600;">Tên Lớp</div>
            <div class="col-md-5">
                @Html.DropDownListFor(model => model.MaLop, new SelectList(""), "--Mời bạn chọn Lớp học--", htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.MaLop, "", new { @class = "text-danger" })
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Thêm mới" class="btn btn-success btn-icon-split p-2 border" />
        </div>
    </div>
}


<div>
    <a href="@Url.Action("index","QuanLySinhVien")" class="btn btn-light btn-icon-split m-2">
        <span class="icon text-gray-600">
            <i class="fas fa-arrow-left"></i>
        </span>
        <span class="text">Quay lại</span>
    </a>
</div>

@section show
{
    <script>
        $(document).ready(function () {
            $("#upload").click(function () {
                $(".form-avatar").removeClass("d-none");
                $(".form-avatar .camera ").addClass("d-none");
                $(".form-avatar .upload ").removeClass("d-none");
            });

            $("#camera").click(function () {
                $(".form-avatar").removeClass("d-none");
                $(".form-avatar .upload ").addClass("d-none");
                $(".form-avatar .camera ").removeClass("d-none");
            });
            // The stream & capture
            var stream = document.getElementById("stream");
            var capture = document.getElementById("capture");
            var snapshot = document.getElementById("snapshot");

            // The video stream
            var cameraStream = null;
            $("#btn-start").click(function () {

                var mediaSupport = 'mediaDevices' in navigator;
                if (mediaSupport && null == cameraStream) {

                    navigator.mediaDevices.getUserMedia({ video: true })
                        .then(function (mediaStream) {
                            cameraStream = mediaStream;
                            stream.srcObject = mediaStream;
                            stream.play();
                        })
                        .catch(function (err) {
                            console.log("Unable to access camera: " + err);
                        });
                }
                else {
                    alert('Your browser does not support media devices.');
                    return;
                }
            });
            $("#btn-stop").click(function () {
                if (null != cameraStream) {
                    var track = cameraStream.getTracks()[0];
                    track.stop();
                    stream.load();
                    cameraStream = null;
                }
            });
            $("#btn-capture").click(function () {
                if (null != cameraStream) {

                    var ctx = capture.getContext('2d');
                    var img = new Image();

                    ctx.drawImage(stream, 0, 0, capture.width, capture.height);

                    img.src = capture.toDataURL("image/png");
                    img.width = 240;

                    snapshot.innerHTML = '';

                    snapshot.appendChild(img);
                }
            })

            $("#MaKhoa").change(function () {
                $.get("/QuanLySinhVien/GetLopHoc", { id: $(this).val() }, function (data) {
                    $("#MaLop").empty()
                    $.each(data, function (index, row) {     
                        $("#MaLop").append("<option value='" + row.MaLop + "'>" + row.TenLop + "</option>")
                        alertSuccess();
                    })
                })
            })

            function alertSuccess() {
                $('.alert').addClass("show");
                $('.alert').removeClass("hide");
                $('.alert').addClass("showAlert");
                setTimeout(function () {
                    $('.alert').removeClass("show");
                    $('.alert').addClass("hide");
                }, 5000);
                $('.close-btn').click(function () {
                    $('.alert').removeClass("show");
                    $('.alert').addClass("hide");
                });
            }
        });
    </script>
}